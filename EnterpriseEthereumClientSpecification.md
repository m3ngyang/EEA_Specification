# 企业以太坊联盟 - 企业以太坊客户端规范 V2

> [原文链接](http://entethalliance.org/wp-content/uploads/2018/10/EEA_Enterprise_Ethereum_Client_Specification_V2.pdf) 本文为保留原意，采用直译方式

[TOC]

## 1. 引言

*本章节是非标准的。*

本规范定义了企业以太坊客户端的实现要求，包括企业以太坊面向外部组件的接口以及它们的使用方式。

企业以太坊基于公共以太坊的技术和概念，仅在必要时扩展以支持企业部署的需求。公共以太坊的扩展旨在满足企业部署的性能（Performance），许可（Permissioning）和隐私（Privacy）需求，非正式地称为企业以太坊的 3P 需求。

### 1.1 为什么要形成客户端规范？

## 2. 一致性

### 2.1 实验要求

### 2.2 要求分类

本规范中所有需求分类如下表所示。


| 种类 | 前缀 | 描述 |
| --- | --- | --- |
| Protocol/协议 | [P] | 如果所有客户都不遵守此要求，则会危及系统的必要的属性和正确性。|
| Client/客户端 | [C] | 如果所有客户都不遵守此要求，也不会危及系统的必要的属性和正确性。客户端需求通常是那些不会影响全局系统行为的需求。|
| External/外部 | [E] | 适用于 EEA 客户端以外的组件。外部要求通常进一步细分，如下所示。|
| External: Development/外部: 开发 | [E:D] | 与智能合约的工具和开发相关的外部要求。|
| External: Operations/外部: 运维 | [E:O] | 与运维相关的外部要求，包括监视和基础结构管理。|


## 3. 安全考虑

*本章节是非标准的。*

信息系统的安全性是一个主要的研究领域。 企业以太坊软件开发与所有软件开发一样，需要考虑安全问题，并有义务依据新的信息技术更新系统实现，以保护其用户及其所运行的生态系统。

然而，以太坊的一些问题，特别是企业以太坊，在企业环境中尤为重要。

### 3.1 针对以太坊客户端的攻击

针对企业以太坊客户端的建模攻击有助于确定需要实现的安全对策并确定其优先级。要考虑的一些攻击类别包括：

* 使用 DNS 重绑定，在浏览器中通过恶意 JavaScript 攻击无身份验证的 [JSON-RPC] 接口；
* 利用[日食攻击](https://www.usenix.org/system/files/conference/usenixsecurity15/sec15-paper-heilman.pdf)耗尽客户端网络资源，或者欺骗客户端的节点发现协议；
* 有针对性地利用 EVM 实现中的共识漏洞；
* 向开源项目提交恶意代码；
* 各类社会工程学攻击；

### 3.2 主动的安全设计模式

复杂接口更容易引入用户错误，因而提高了系统的风险性。例如，手动输入以太坊地址很容易出错。因此，实现可以通过提供用户友好的界面来降低风险，确保用户使用一些辅助工具来正确地选择不透明的标识符，例如联系人管理器。

Gas 之类的以太坊功能降低了流氓网络参与者发起的资源消耗攻击的风险。企业以太坊提供了额外工具来降低安全风险，例如对网络中的操作进行更精细的权限管理。

权限管理在缓解网络级攻击（如51％攻击）方面发挥了一定作用，但重要的是要仔细思考哪些是以太坊客户端实现过程中更为关注的风险，哪些是最好通过更新以太坊一致性协议来缓解的风险。

### 3.3 敏感数据的处理

网络上所存储的私有数据的含义同样需要重点考虑，并引申出本规范中的若干要求。

任何公共平台（例如以太坊区块链）上的加密数据的长期保存使其暴露于暴力攻击的风险之下，而且攻击速度随密码分析中必然的周期性发展而加快，加密数据可能最终被破解。未来转向采用“后量子”加密技术的是当前的一个考虑，但它可能不会成为该领域的最后阶段。假设没有加密方案保证永恒性，因此需要一定程度的保护来合理地超过敏感数据的生命周期。

除了用户生成的数据，以太坊客户端还负责管理和保护私钥。在存储之前使用密码短语或其他身份验证凭据加密私钥有助于防止泄露。此外，将事件记录到日志文件时，不要泄露敏感数据也很重要。

### 3.4 客户端实现的安全性

有几个特定的功能由于实现的漏洞更容易造成安全性问题。在企业以太坊客户端的设计和安全评估期间，这些应该得到更多关注：

* P2P 协议的实现；
* 对象反序列化方式；
* 以太坊虚拟机（EVM）的实现；
* 键对的生成方式；

P2P 协议用于点对点以太坊网络中的节点之间的通信，它也是将客户端暴露于不可信输入的主要来源。在任何软件中，处理不可信输入的程序逻辑是实现安全数据处理的主要关注区域。

对象的序列化与反序列化通常是 P2P 协议的底层实现的一部分，但也是复杂性的来源，它历来是许多实现和编程语言中易于出现安全漏洞的地方。选择提供严格控制数据类型的反序列化器有助于降低风险。

EVM 实现的正确性是以太坊客户端最为重要的考虑因素。除非 EVM 对所有可能的输入具有行为一致性，否则如果输入引发了客户端行为的差异性，存在硬分叉事件的严重风险。 EVM 实现还暴露于由恶意构建的智能合约发起的 DoS 攻击的风险，以及可利用的远程代码执行漏洞这类更严重风险。

本规范定义了公钥/私钥对的格式和加密算法选择的多方面技术，此外以太坊客户端的实现也负责使用经过充分审查的加密库来正确生成这些密钥。具体地，客户端需要在密钥对生成步骤期间选择适当的种子及安全加密的伪随机数生成器。 一个不安全的伪随机数生成器通常难以通过观察其输出发现，而是使攻击者能够攻破加密并获取用户的敏感数据。

## 4. 企业以太坊概念

*本章节是非标准的。*

企业以太坊实现的是公共以太坊的扩展部分，提供以企业为中心的附加功能，包括执行私有交易，强化成员身份管理（权限）以及提供交易吞吐量扩容的功能。私有交易是只有参与该交易的各方才能读取元数据或有效负载数据的交易。

以下两个图显示了企业以太坊组件之间的关系，这些组件可以是任何符合 EEA 标准的客户端实现。第一个是接口库架构的栈式表示，而第二个是传统的以太坊架构。

图

企业以太坊的架构包含以下五个层：

* 网络层
* 核心区块链层
* 隐私和扩容层
* 工具层
* 应用层

这些层级在以下章节中予以讲解。

### 4.1 网络层

网络层包括对等（P2P）网络协议的实现，允许以太坊节点使用例如 DEVp2p 之类协议彼此通信。随着时间的推移，其他企业 P2P 协议将正式化，来支持更高级别层级所需的通信。

### 4.2 核心区块链层

核心区块链层包含一种共识机制，用于在以太坊节点之间达成共识来决定是否接纳新块。公共共识算法提供了一种在使用公共以太坊链操作时执行此操作的方法。公共一致性算法的一个例子是在[以太坊黄皮书](https://github.com/ethereum/yellowpaper)中描述的工作证明（PoW）算法。 随着时间的推移，PoW 可能会逐渐停止使用，并被新方法取代，例如 Proof of Stake（PoS）。

企业以太坊的实现方案需要提供在私有财团网络情况下的一致性算法。

> 示例1：一致性算法
> 
> 一致性算法包括伊斯坦布尔算法(拜占庭容错, IBFT)[EIP-650]，[RAFT] 和 Proof of Elapsed Time[PoET]。

执行子层需要在客户端内实现所使用的虚拟机，例如以太坊虚拟机（EVM）或以太网风格的 WebAssembly[eWASM]，它的指令集以及所需的其他计算功能。

最后，核心区块链层也需要提供存储和账本子层来存储区块链状态，例如智能合约以供稍后执行。该子层需遵循区块链安全范例，例如使用加密的散列尝试，未使用的交易输出（UTXO）模型或静态加密的键值存储。

### 4.3 私有和扩容层

私有和扩容层实现企业以太坊中必要私有和扩展扩展功能，以支持企业级部署。

本规范并未试图限制实验，来提高将来公共以太坊或企业以太网实现的可扩展性。相反，人们意识到，随着时间的推移，客户端针对扩容功能会有多种形式的改进，但其确切形式目前尚不清楚。

扩容性解决方案大致分为第 1 层和第 2 层两种。

第1层扩容解决方案在基础级协议层实现，这种方案利用例如 [分片技术] 和简单的并行技术 [EIP-648] 来实现链内（On-Chain）扩容。

第2层扩展解决方案不需要更改基础级协议层，而是利用智能合约在应用协议层上实现，这种解决方案利用例如 [Plasma] 和 [state-channel] 之类的技术，以及其他链外（Off-Chain）缩放机制来实现。

同样，各种链内（On-Chain）隐私机制也正被积极探索，例如支持公共以太坊上的零知识证明。

企业以太坊的实现方案需要为私有交易提供支持，这一点将在下文予以阐明。此外，实现方案还需要为链外（Off-Chain）可信计算提供支持，在代码执行期间实现隐私保护。

### 4.4 工具层

工具层包含用于与客户端通信的API。最主要的 API 是一个 JSON-RPC 接口，用于提交待执行的交易或部署智能合约以维持任意状态。其他 API 同样也是允许的，包括用于区块链链内操作和调用外部服务的API，例如可信任的 oracles。

公共以太坊节点通常使用通用集成库来实现，例如 [web3j]，[web3.js] 或 [Nethereum]。同样，企业以太坊实施最好使用通用 API，库和技术来与企业管理系统集成。

公共以太坊节点可以选择提供用户凭证的本地处理的能力，例如密钥管理系统和钱包，这类功能可以在客户端主题功能之外予以实现。企业以太坊的实现可以利用基于用户权限和身份验证方案达到受限操作的目的。

工具层还通过使用一种或多种智能合约语言的解析器和编译器，来支持智能合约的编译和形式验证。[Solidity] 和 [LLL] 是实现中最为常见的支持语言，但也不受限制对其他语言的支持。

### 4.5 应用层

最后，应用层通常完全或部分存在于客户端之外，来提供更高级别的服务。例如，以太坊名字服务（ENS），节点监视器，区块链状态可视化和浏览器，自我主权和其他身份方案，钱包以及所设想的生态系统的任何其他应用。

钱包可以使用扩展 RPC API 与企业以太坊扩展组件交互，如图 2 所示。钱包还可以直接与私有交易管理器或与公共以太坊客户端的接口交互。

## 5. 应用层

## 6. 工具层

## 7. 私有与扩容层

### 7.1 隐私子层

在本规范的语境中，隐私（privacy）是指在与该交易有关的各方之间保持数据机密性，并且选择向一个或多个其他参与者提供关于某个参与者的特定细节的能力。

企业以太坊实现方案需要提供不同程度的交易隐私性，可以在各种级别实现隐私性，包括对等节点连接许可和用户级权限，控制哪些节点看到私有交易，以及混淆交易数据。第7.1.4节“隐私级别”中详细介绍了实现合规隐私级别的选项。

#### 7.1.1 链内方式

目前，已经提出多种链内技术来提升网络的安全性和隐私性。

> 注解：链内安全技术
> 
> 将来的链内安全技术可能包括诸如 ZK-SNARKS，范围证明（range proof）或环签名（ring signatures）等技术。
> 支持私有私有交易是隐私需求的未来工作的一个方向。

#### 7.1.2 链外方式（可信计算）

链外处理场景中，区块链的链外可信计算可以为交易和智能合约提供安全，高效和可扩容的处理能力，并保证敏感联系数据的隐私性。

* [C] OFFCH-010: 企业以太坊实现方案 *MAY* 为交易和智能合约提供链外的，可信的执行能力。

#### 7.1.3 私有交易

许多企业以太坊实施的用户和运营商都需要按照当地法律，遵守与隐私相关的法律和法规。例如，欧盟的银行在提供支付服务时必须遵守欧盟修订的支付服务指令[Payment Services Directive, PSD2]，并在存储有关个人的个人数据时遵守通用数据保护条例[General Data Protection Regulation, GDPR]。企业以太坊的用户通过利用 [JSON-RPC-API] 发送交易时，API 的参数暗含了他们对隐私数据需求，该参数指明运行时的首选的交易类型。本节定义了两种用于不同隐私要求的交易类型：

* 受限的私有交易
* 非受限的私有交易

交易信息由两部分组成，元数据和有效负载数据。元数据是执行交易所必需的封装信息，有效载荷数据是交易内容。

* [P] PRIV-010: 实现方案 *MUST* 至少使用以下一种方法来支持私有交易：

    * 如果私有交易的有效载荷数据仅能被交易的直接参与者传输和读取，那么这种交易称为受限的私有交易。
    * 如果私有交易的有效载荷数据可以被传输到网络中的所有节点上，但只能由交易的直接参与者读取，那么这种交易被称为非受限的私有交易。

当实现受限的私有交易时：

* [P] PRIV-020: 实现方案 *MUST* 支持在受限的私有交易中存储有效负载数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-030: 实现方案 *MUST* 支持在受限的私有交易中传输有效负载数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-040: 实现方案 *MAY* 支持在受限的私有交易中存储元数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-050: 实现方案 *MAY* 支持在受限的私有交易中传输元数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-060: 受限的私有交易中的中继但非参与节点 *MUST NOT* 存储交易的有效负载数据。
* [P] PRIV-070: 受限的私有交易中的中继但非参与节点 *SHOULD NOT* 存储交易的元数据。
* [P] PRIV-080: [JSON RPC API] 的实现中，`restriction` 参数设置为 `restricted` 的 `eea_sendTransactionAsync` 或`eea_sendTransaction` 方法（如果已实现） *MUST* 产生一个受限的私有交易。

> 示例6：受限的私有交易
> 
> 私有交易可以通过创建私有通道或私有智能合约来实现，其中有效载荷数据仅存储在参与交易的节点内，而不存储在任何其他节点中（尽管有效负载数据可能被加密并且只能由授权方解码）。私有交易仅在参与方之间可见，因此无关方无法访问交易内容，发送方或参与地址列表。事实上，私有智能合约和区块链中的私链具有相似之处，区块信息都只在参与节点子集中备份和认证，但却在宿主链上公证并同步。(In fact, a private smart contract has a similar relationship to the blockchain that hosts it as a private blockchain network that is only replicated and certified by a subset of participating nodes, but is notarized and synchronized on the hosting blockchain.)因此，这种私有区块链能够在限制较少的私人智能合约以及公共智能合约中引用数据。

当实现非受限的私有交易时：

* [P] PRIV-090: 实现方案 *SHOULD* 支持在非受限的私有交易中存储接受方身份时对其进行模糊处理，例如使用加密算法加密或环签名和混淆技术。
* [P] PRIV-100: 实现方案 *SHOULD* 支持在非受限的私有交易中存储发送方身份时对其进行模糊处理，例如使用隐形地址（stealth addresses）。
* [P] PRIV-110: 实现方案 *SHOULD* 支持在非受限的私有交易中存储有效负载数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-120: 实现方案 *SHOULD* 支持在非受限的私有交易中传输有效负载数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-130: 实现方案 *MAY* 支持在非受限的私有交易中存储元数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-140: 实现方案 *MAY* 支持在非受限的私有交易中传输元数据时对其进行模糊处理，例如使用加密算法加密。
* [P] PRIV-150: 非受限的私有交易中的中继但非参与节点 *MAY* 存储交易的有效负载数据。
* [P] PRIV-160: 非受限的私有交易中的中继但非参与节点 *MAY* 存储交易的元数据。
* [P] PRIV-170: [JSON RPC API] 的实现中，`restriction` 参数设置为 `unrestricted` 的 `eea_sendTransactionAsync` 或`eea_sendTransaction` 方法（如果已实现） *MUST* 产生一个非受限的私有交易。
* [P] PRIV-180: 实现方案 *SHOULD* 能够扩展私有交易参与者的集合（或以某种方式转发私有交易）。
* [P] PRIV-190: 实现方案 *SHOULD* 能够为节点提供在它们互相私有的交易上达成共识的能力。
* [P] PRIV-200: 实现方案 *SHOULD* 能够授权并指定以太坊帐户可以提交的交易类型，为以下方面提供单独的权限：
    * 部署智能合约
    * 调用更改智能合约状态的函数
    * 执行简单的价值转移

> 示例7: 非受限的私有交易
> 
> 所有节点备份的模糊处理的数据即使是加密的，依然可以从任意一节点重新构造。基于数字数据的数学交易旨在底层网络利用零知识的基础上进行验证，仅能由交易的参与方完全访问。具体而言，客户端应当能够在零知识的基础上维护和交易经过所有验证者认证的数字余额。零知识方法的替代方案可以是环签名，隐形地址和混淆技术的组合使用，这种替代技术提供了必要的混淆能力级别，它在数学证明上是不可能渗透的，并且不依赖于 ZK-SNARKS 所需的可信设置。

两种私有交易类型的对比。

> 注解: 受限与非受限私有交易的对比
> 
> 受限与非受限私有交易的对比总结在下表中。
> 
| 受限的私有交易 | 受限的私有交易 | 非受限的私有交易 | 非受限的私有交易 |
| --- | --- | --- | --- |
| 元数据 | 有效负载数据 | 元数据 | 有效负载数据 |
|  *MAY* 模糊处理 |  *MUST* 模糊处理 |  *MAY* 模糊处理， *SHOULD* 对发送方和接受方的身份模糊处理 | 传输中 *MUST* 模糊处理，存储中 *SHOULD* 模糊处理 |
| *SHOULD NOT* 被非参与节点存储 | *MUST NOT* 被非参与节点存储 | *MAY* 被非参与节点存储 | *MAY* 被非参与节点存储 |

#### 7.1.4 隐私子层

实现方案应该可以支持不同级别的隐私性，如下面的表3所示，并且仍然符合本规范。由于权限和隐私是相互关联的概念，因此指定的隐私级别包含与本规范的权限和隐私部分相关的要求。

C 级隐私是所有兼容实现方案的最低要求。为了满足 C 级隐私，实现必须遵守本规范的所有 *MUST* 和 *MUST NOT* 的要求。实现方案提供对第 6.1.1 节《节点》和第 6.1.2 节《参与方》的对等节点连接和权限中提及的所有 *MUST* 要求的支持。在遵守隐私要求时，实现方案有两种选择，实现第 7.1.3 节《私有交易》中受限的私有交易中所有的 *MUST* 和 *MUST NOT* 要求，或者实现第 7.1.3 节《私有交易》中非受限的私有交易中所有的*MUST* 和 *MUST NOT* 要求。

支持特定的 *SHOULD* 要求增强了实现的隐私和许可能力，因此被认为对用户具有特定价值。

B 级隐私在完整支持 C 级隐私要求的基础上，提供第 6.1.1节《节点》，第 6.1.2 节《参与方》和第 6.1.4 节《附加许可要求》中对等节点连通和权限的中所提及的所有 *SHOULD* 要求的支持。对 B 级隐私的支持可以增强与公有以太坊生态和其他企业以太坊的交互性。

A 级隐私在完整支持 B 级隐私要求的基础上，提供第 7.1.3 节《私有交易》中提及的所有 *SHOULD* 和 *SHOULD NOT* 要求。A 级隐私要求提升了安全性并且保护了用户的隐私，是企业以太坊的最佳实现方案和推荐的隐私级别。

EEA 认证计划将根据实现将其划分到  A/B/C 级隐私支持，并且认证证书需符合 EEA 认可的垂直业务部门的特定要求。

| 隐私等级 | 描述 | 定义 |
| --- | --- | --- |
| A | 隐私和权限的最佳实践 | 实现方案提供对 B 级隐私的支持以及第 7.1.3 节《私有交易》中的所有 *SHOULD* 和 *SHOULD NOT* 的要求。|
| B | 权限的最佳实践 | 实现提供对 C 级隐私以及第 6.1.1节《节点》，第 6.1.2 节《参与方》和第 6.1.4 节《附加许可要求》中对等节点连通和权限的中所提及的所有 *SHOULD* 要求的支持。|
| C | 隐私和权限的基线 | 实现方案提供对第 6.1.1 节《节点》和第 6.1.2 节《参与方》的对等节点连接和权限中提及的所有 *MUST* 要求的支持，以下任一要求：① 第 7.1.3 节《私有交易》中受限的私有交易中所有的 *MUST* 和 *MUST NOT* 要求。② 第 7.1.3 节《私有交易》中非受限的私有交易中所有的*MUST* 和 *MUST NOT* 要求。|

### 7.2 扩容子层

企业以太坊网络往往对交易的速率和体量有更高的需求，甚至会有繁重的计算任务。因此，可以采用多种扩容策略来提升交易的处理速率。

#### 7.2.1 链内（On-chain, Layer 1）

第 1 层的链内扩容策略修改底层以太坊协议来提升交易的处理能力。

#### 7.2.2 链内（On-chain, Layer 2）

第 2 层的链内（原文为Off-chain，似乎为typo）扩容策略同样可以提升交易的处理能力，但却不用修改底层以太坊协议。

* [P] SCAL-010: 企业以太坊的实现方案 *SHOULD* 利用第 1 层和第 2 层的策略提升交易和智能合约的处理速率。

#### 7.2.3 链外（Off-chain, 计算）

链外扩容能力转移了底层区块链网络的一些处理负担。

* [C] SCAL-020: 企业以太坊的实现方案 *SHOULD* 提供链外处理交易和智能合约的能力。

#### 7.2.4 性能

性能指的是区块链网络的整体性能。理性情况下，提高网络的使用率不应该降低其性能。

根据 EEA 通过的垂直业务部门的需求，EEA 认证计划来判断实现方案是否提供了合适于企业的交易速率支持。

> 实例8：EEA 认证
> 
> 认证证书可能会对最低交易速率有所要求，例如按照 [ERC-20] 每秒智能合约执行次数或是其他标准。

## 8. 核心区块链层

### 8.1 存储和合约子层

* [P] STOR-010: 企业以太坊实现方案 *SHOULD* 实现操作公共以太坊客户端所必需的数据存储需求。
* [C] STOR-020: 实现方案 *MAY* 实现用于可选的链外操作的数据存储功能。例如，实现可以在本地选择缓存来自可信任 oracle 的结果，或者存储与本规范范围之外的系统扩展组件相关的信息。
* [C] STOR-030: 当实现方案支持多个网络（例如，一个或多个联盟网络或公共网络）时，*MUST* 将这些链的私有交易的相关数据保存到该链的专属私有状态里。
* [P] STOR-040: 操作私有状态的智能合约 *SHOULD* 有权限访问同一个参与方所执行的其他智能合约所产生的私有状态。
* [P] STOR-050: 操作私有状态的智能合约 *MUST NOT* 有权限访问其他参与方所执行的其他智能合约所产生的私有状态。
* [P] STOR-060: 实现方案 *SHOULD* 为私有智能合约提供无缝和透明地存储文件对象的能力，因此无需其他的链外文件存储插件。
* [P] STOR-070: 如果实现方案持久存储私有区块链状态，它 *SHOULD* 使用带有附加数据的认证加密（AEAD）算法来保护数据，例如 [RFC5116] 中描述的算法。

> 实例9：存储文件对象
> 
> 实现方案可以选择提供本规定以外的 API 来实现和和文件对象的交互，例如 [RFC4918] 所描述的 WebDAV 协议。

#### 8.1.1 终止性

* [P] FINL-010: 当使用确定性一致性算法时，在定义的间隔或事件之后，交易应该被认为是终止的。例如，自交易被打包入块后一定的时间或产生一定的新块之后，该交易即被认为是终止的。

### 8.2 执行子层

* [P] EXEC-010: 企业以太坊实现方案所实现的智能合约执行环境 *MUST* 实现公有以太坊 EVM 操作集 [EVM-Opcodes]。
* [P] EXEC-020: 企业以太坊实现方案所实现的智能合约执行环境 *MAY* 扩展公有以太坊 EVM 操作集 [EVM-Opcodes]。
* [P] EXEC-030: 企业以太坊实现方案 *SHOULD* 支持根据其他公有以太坊节点所持有的公有状态来同步自己的公有状态。
* [P] EXEC-040: 企业以太坊实现方案 *SHOULD* 支持预编译合约的编译、存储和执行功能。
* 可信计算确保只有授权方才能在与给定联盟网络相关的执行环境中运行智能合约。
* [C] EXEC-050: 企业以太坊实现方案 *MAY* 支持可信计算。
* 多种加密技术可用于保护可信计算和私有状态的安全。
* [C] EXEC-060: 企业以太坊实现方案 *SHOULD* 支持通过配置指定和联盟网络通讯的加密方式。

### 8.3 共识子层

* [P] CONS-020: 实现方案 *MUST* 有能力支持多种共识算法。
* [P] CONS-030: 实现方案 *SHOULD* 支持企业以太坊网络的一部分使用一种或多种共识算法。
* [P] CONS-050: 实现方案 *MAY* 允许企业以太坊网络的侧链使用一种或多种共识算法。
* [P] CONS-080: 根据要求，共识算法 *MAY* 在带内或带外与其他客户端进行通信。即，共识算法实现可以在客户端到客户端网络协议之外建立和接收网络流量。
* [P] CONS-100: 实现方案 *MAY* 支持其他共识算法。
* [P] CONS-110: 实现方案 *MUST* 支持通过配置的方式为每条公有链、私有链及使用中的侧链指定共识算法。

## 9. 网络层

### 9.1 网络协议子层

网络协议定义了节点之间的通讯方式。

* [P] PROT-010: 节点 *MUST* 是唯一的，且用以太坊 enode URL格式公布对外公布。
* [P] PROT-020: 实现方案 *SHOULD* 使用 DEVp2p Wire 协议[DEVp2p-Wire-Protocol] 在节点之间传递消息，以建立和维护高层协议使用的通信信道。这些更高层协议称为能力协议。

[Ethereum-Wire-Protocol] 定义了以太坊客户端节点之间用于交换状态的消息传递的能力协议，包括块和交易信息。[Ethereum-Wire-Protocol] 消息通过节点之间已建立的 DEVp2p 连接发送和接收。
    
* [P] PROT-030: 实现方案 *SHOULD* 至少支持 eth/62 和 eth/63 [Ethereum-Wire-Protocol] 实现。
* [P] PROT-040: 实现方案 *MAY* 支持新增协议或者扩展已有以太坊协议。
* [P] PROT-050: 为了最小化私有节点之间所需的点对点连接的数量，一些私有节点 *SHOULD* 能够将私有交易数据中继到多个其他私有节点。
* [P] PROT-060: 实现方案 *SHOULD* 实现 Whisper protocol [Whisper-protocol]。

> 实例10：中继私有交易数据
> 
> 多方私有智能合约和交易不需要所有各方之间的直接连接，因为这在企业环境中非常不切实际，特别是当许多方被允许进行交易时。所有各方的共同节点（例如，作为所有各方的引导节点的选民或块制作者，以及作为备份或灾难恢复节点）旨在用作透明地同步私有智能合约的网关。然后，私人智能合约的交易可以以相同的方式传送给所有参与方。

## 10. 反垃圾信息

## 11. 跨客户端兼容性

## 12. 同步与容灾

## A. 附录

### A.1 术语表

### A.2 鸣谢

### A.3 变更

## B. 引用 

